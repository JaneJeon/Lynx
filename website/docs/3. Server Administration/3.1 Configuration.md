## How do I configure shit?

There are two ways to configure environment variables. One is by simply exposing these variables to the environment (duh), but take care to make sure that these variables won't simply just disappear on reboot, and to actually expose them to the container if you're using Docker (you can use -e flags to pass environment variables to the underlying container).

The other way is by configuring `.env` files. These env files are loaded in the following order (meaning, if you have `VAR=1` in `.env.production.local` and `VAR=2` in `.env`, the application will see `VAR=1`):

```
.env.production.local
.env.production
.env.local
.env
```

Note that non-local environment files are checked in through git, so I suggest creating `.env.production.local` and using that for configuring production workloads instead of just overriding whatever is in `.env`. And again, if you're using Docker, make sure to actually volume map these files to the _inside_ of the containers (the directory to mount it on is `/home/node`).

## App-specific configuration

For the most part, the comments on `.env` files should be sufficient, but I'll explain some of the more confusing ones here just in case.

### HOMEPAGE, BASE_URL, and all the other OIDC shit

See the bit about the domain name and identity provider in the [Prereqs page](/Installation/2.1%20Prerequisites)

### Sessions

You can configure `SESSION_DURATION`/`SESSION_SECRET`. The session does not "roll over" once it expires. The session is stored in Redis, using cookie-based authentication.

Please please _please_ make sure to change `SESSION_SECRET` to something ACTUALLY long and private. If you're deploying via Heroku, it should already be automatically done for you.

### Rate limiting

Rate limiting is crucial to prevent abuse of the Blink server, even if you have DDoS protection. There are two _classes_ of "users" for Blink:

1. Internal users who are using the application from their web browser (from our integrated React frontend)
2. API clients who are calling Blink's API directly

For class 1, we really don't need to worry much about abuse, so we keep a fairly generous global rate limit (tuned by `RATE_LIMIT_SHORT_WINDOW` and `RATE_LIMIT_SHORT_MAX`, dictating how many times someone can make a request within a given window), to provide basic protection from "bursty" workloads that might result from organic use of Blink, in order to protect the server from going down.

For class 2, we need to make sure the "blast radius" is as contained as possible, so that in case of a leaked credential, or someone trying to scrape the application, or someone trying to brute force authentication, they can only do so much (`RATE_LIMIT_LONG_MAX`) within a given window (`RATE_LIMIT_LONG_WINDOW`). Note that this "long" rate limiter only applies to `/api` and `/auth` endpoints.

### Timeouts

We scrape our own links here at $CORP to fill in the blanks about any given link. We have a customizable timeout via `LINK_TIMEOUT`. Increase this if the link scraping is not working.

### Cache

There are two ways to go about configuring `CACHE_MAX_AGE`:

1. Keep it relatively short (e.g. a few hours) so that the CDN would revalidate with the Blink server relatively often.
2. Keep it basically "infinite" (the default) so that the CDN would hold onto the cache hopefully forever.

Option 1 is better if you plan on busting the cache semi-regularly and don't want to rely on some integration to bust the cache _for_ you (at the cost of higher server load and serving slightly stale links, should you change/delete a link).

Option 2 is better if you plan on either never "deleting" links from Blink or busting the cache manually or via an integration (which will be coming post-v1 launch).
